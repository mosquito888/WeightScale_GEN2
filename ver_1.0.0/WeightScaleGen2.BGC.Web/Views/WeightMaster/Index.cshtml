@using WeightScaleGen2.BGC.Web.Common
@model WeightScaleGen2.BGC.Models.ViewModels.WeightSummaryDay.ParamSearchWeightSummaryDayViewModel
@{
    ViewData["PageTitle"] = @ViewBag.MenuName;
}
@Html.AntiForgeryToken()
<div class="h-100">
    @* Header Section *@
    <div class="pageMenuTitle">
        <h3 class="text-black">ทำสำเนา และลบข้อมูลประจำวัน</h3>
    </div>

    @* Search Section *@
    <div id="dataContainerHeight" class="dataContainer">
        <div class="w-full p-4 bg-white sm:p-6 md:p-8 dark:bg-gray-800 dark:border-gray-700 mb-4">
            <div class="flex flex-col items-center justify-center">
                <div id="weightMaster-ProgressBar" class="loaderStyle-1 my-8 absolute top-0"></div>
                <img src="~/img/weight-master/weight-master.gif" class="w-5/8 md:w-2/8 mx-auto mb-5" />
                <button type="button" onclick="ConfirmCopyDelete()" class="buttonAction primary-bg flex align-items-center">
                    <lord-icon src="https://cdn.lordicon.com/xqdfobxg.json" trigger="hover" stroke="bold" colors="primary:#ffffff,secondary:#ffffff" style="width:20px;height:20px" class="mr-2"></lord-icon>
                    ทำสำเนาและ ลบข้อมูล
                </button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function ConfirmCopyDelete() {
                    Swal.fire({
                        title: 'ยืนยันการ Backup และลบข้อมูลการชั่ง ?',
                        text: '',
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'ยืนยัน',
                        cancelButtonText: 'ยกเลิก',
                        confirmButtonClass: 'd-sm-inline-block btn btn-sm btn-outline-primary shadow-sm',
                        cancelButtonClass: 'd-sm-inline-block btn btn-sm btn-outline-danger shadow-sm',
                        buttonsStyling: false,
                    }).then(function (result) {
                        if (result.value) {

                            $.ajax({
                                cache: false,
                                async: true,
                                type: "POST",
                                url: '@Url.Action("CopyDelete", "WeightMaster")',
                                data: null,
                                success: function (data) {
                                    if (data.status == '@Constants.Result.Success') {
                                        var timerInterval
                                        Swal.fire({
                                            title: 'Backup และลบข้อมูลสำเร็จ !',
                                            html: 'I will close in <strong></strong> seconds.',
                                            timer: 750,
                                            icon: "success",
                                            showCancelButton: false, // There won't be any cancel button
                                            showConfirmButton: false, // There won't be any confirm button
                                            buttonsStyling: false,
                                            onBeforeOpen: function () {
                                                document.getElementById('weightMaster-ProgressBar').style.display = 'block';
                                                Swal.showLoading()
                                                timerInterval = setInterval(function () {
                                                    Swal.getContent().querySelector('strong')
                                                        .textContent = Swal.getTimerLeft()
                                                }, 100)
                                            },
                                            onClose: function () {
                                                clearInterval(timerInterval)
                                            }
                                        }).then(function (result) {
                                            if (
                                                // Read more about handling dismissals
                                                result.dismiss === Swal.DismissReason.timer
                                            ) {
                                                console.log('หน้าต่างจะปิดในเวลา')
                                                location.reload();
                                            }
                                        })
                                    } else if (data.status == '@Constants.Result.Invalid') {
                                        Swal.fire({
                                            icon: 'error',
                                            title: 'คำเตือน',
                                            text: data.message,
                                            showCancelButton: false,
                                            confirmButtonColor: '#3085d6',
                                            confirmButtonText: 'ตกลง',
                                            confirmButtonClass: 'd-sm-inline-block btn btn-sm btn-outline-primary shadow-sm',
                                            buttonsStyling: false,
                                        })
                                    } else {
                                        Swal.fire({
                                            icon: 'error',
                                            title: 'คำเตือน',
                                            text: data.message,
                                            showCancelButton: false,
                                            confirmButtonColor: '#3085d6',
                                            confirmButtonText: 'ตกลง',
                                            confirmButtonClass: 'd-sm-inline-block btn btn-sm btn-outline-primary shadow-sm',
                                            buttonsStyling: false,
                                        })
                                        toastr['error']('Fail - ' + data.message, 'Warning!', ErrOpt);
                                    }
                                },
                                error: function (err) {
                                    toastr['error']('Fail', 'Warning!', ErrOpt);
                                },
                                complete: function (data) {
                                }
                            });
                        }
                    })
            }
    </script>
}